<!DOCTYPE html>function updateActiveNode() {
<html lang="en">    if (activeNode) {
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improved Scientific Thinking Cycle Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.2/svg.min.js"></script>
    <style>
        :root {
            --primary-color: #0066cc;
            --background-color: #f0f0f0;
            --text-color: #333;
            --hover-color: #004499;
        }
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            box-sizing: border-box;
        }
        #cycle-container, #instructions {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 2px solid var(--text-color);
        }
        #cycle-container {
            aspect-ratio: 1/1;
            position: relative;
        }
        #instructions {
            padding: 20px;
        }
        .sidebar {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .sidebar.open {
            right: 0;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-color);
        }
        a {
            color: var(--primary-color);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
            color: var(--hover-color);
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            #instructions, #cycle-container {
                border-radius: 5px;
            }
            .sidebar {
                width: 100%;
                right: -100%;
            }
        }
    </style>        activeNode.attr('stroke', {color:'#333',width:0.3});
</head>    }
    activeNode = nodeGroup.children()[activeIndex];
    <div id="instructions">
        <h2>Improved Scientific Thinking Cycle Tool</h2>
        <p>This interactive tool helps you understand and apply the scientific method. Click or use keyboard navigation to explore each step of the cycle.</p>
        <p><strong>How to use:</strong></p>
        <ol>
            <li>Start at the "Wonder" step and follow the cycle clockwise.</li>
            <li>Click or press Enter on each step to open detailed information.</li>
            <li>Use arrow keys to navigate between steps.</li>
            <li>Press Esc to close the sidebar.</li>
            <li>Hover over steps for quick tooltips.</li>
        </ol>    activeNode.attr('stroke', {color:'#0066cc',width:1});
    </div>
    <div id="cycle-container" role="application" aria-label="Scientific Thinking Cycle"></div>    // Update the position of the selection box/marker
    <div id="sidebar" class="sidebar" aria-live="polite">
        <button class="close-btn" aria-label="Close sidebar">&times;</button>
        <h2 id="sidebar-title"></h2>
        <p id="sidebar-description"></p>
        <h3>Metacognitive Prompt:</h3>
        <p id="sidebar-metacognitive"></p>
        <h3>Collaborative Inquiry:</h3>
        <p id="sidebar-collaborative"></p>
        <h3>Nature of Science Connection:</h3>
        <p id="sidebar-nos"></p>
        <h3>Stuck?</h3>
        <p id="sidebar-stuck"></p>    const angle = (activeIndex / cycleSteps.length) * 2 * Math.PI - Math.PI / 2;
    </div>    const x = centerX + radius * Math.cos(angle), y = centerY + radius * Math.sin(angle);
    <div id="tooltip" class="tooltip"></div>    const selectionBox = document.getElementById('selection-box');
    selectionBox.style.left = `${x - nodeRadius}px`;
    selectionBox.style.top = `${y - nodeRadius}px`;
            {name:"Wonder",color:"#FF9999",description:"Observe the world around you and identify interesting phenomena.",metacognitive:"What aspects of the world around me spark my curiosity? Why do these things interest me?",collaborative:"Share your observations with a classmate. How do their interests differ from or align with yours?",nos:"Scientists often draw inspiration from everyday observations. How does this relate to your own curiosity?",stuck:"Look around your classroom or out the window. What do you see that makes you curious? Try asking <a href='https://chat.securly.com/#/chats/newchat' target='_blank'>Scribly</a>: 'What are some interesting scientific phenomena I might observe in a typical classroom?'"},}
            {name:"Question",color:"#FFCC99",description:"Formulate a specific, testable question about your observation.",metacognitive:"How can I turn my wonder into a specific, answerable question? What do I already know about this topic?",collaborative:"Discuss your question with peers. How can you refine it based on their input?",nos:"Scientific questions are specific and testable. How does your question meet these criteria?",stuck:"Use question starters like What, How, Why, When, Where, or Which. Ask <a href='https://chat.securly.com/#/chats/newchat' target='_blank'>Scribly</a>: 'How can I turn this observation [your observation] into a testable scientific question?'"},          case 'Enter':
                    selectNode(activeIndex);
                    break;
                case 'Escape':
                    hideSidebar();
                    break;
            }
        });

        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
tooltip.textContent = text;
            tooltip.style.left = `${event.clientX + 10}px`;
            tooltip.style.top = `${event.clientY + 10}px`;
            tooltip.style.opacity = 1;
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = 0;
        }

        // Initialize with the first step
        selectNode(0);

        // Responsive font size adjustment
        function adjustFontSize() {
            const container = document.getElementById('cycle-container');
            const computedStyle = window.getComputedStyle(container);
            const width = parseFloat(computedStyle.width);
            const baseFontSize = width / 50; // Adjust this ratio as needed
            document.documentElement.style.setProperty('--base-font-size', `${baseFontSize}px`);
        }

        window.addEventListener('resize', adjustFontSize);
        adjustFontSize(); // Initial call

        // Analytics
        function logInteraction(action, stepName) {
            // In a real implementation, this would send data to an analytics service
            console.log(`User ${action} step: ${stepName}`);
        }

        // Attach logInteraction to node selection
        function selectNodeWithLogging(index) {
            logInteraction('selected', cycleSteps[index].name);
            selectNode(index);
        }

        // Replace previous selectNode calls with selectNodeWithLogging
        nodeGroup.children().forEach((node, index) => {
            node.click(() => selectNodeWithLogging(index));
        });

        // Accessibility enhancements
        nodeGroup.children().forEach((node, index) => {
            node.attr('aria-label', `${cycleSteps[index].name} step`)
                .attr('role', 'button')
                .attr('tabindex', 0);
        });

        // Keyboard navigation
        container.addEventListener('keydown', (e) => {
            const currentNode = nodeGroup.children()[activeIndex];
            switch(e.key) {
                case 'ArrowRight':
                    e.preventDefault();
                    selectNodeWithLogging((activeIndex + 1) % cycleSteps.length);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    selectNodeWithLogging((activeIndex - 1 + cycleSteps.length) % cycleSteps.length);
                    break;
                case 'Enter':
                case ' ':
                    e.preventDefault();
                    selectNodeWithLogging(activeIndex);
                    break;
            }
        });

        // Progressive enhancement: Add animations if browser supports it
        if (typeof document.body.animate === 'function') {
            nodeGroup.children().forEach((node) => {
                node.mouseover(function() {
                    this.animate(200).transform({ scale: 1.1 });
                }).mouseout(function() {
                    this.animate(200).transform({ scale: 1 });
                });
            });
        }
    </script>
</body>
</html>